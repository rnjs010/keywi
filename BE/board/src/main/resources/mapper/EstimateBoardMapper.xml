<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.board.mapper.EstimateBoardMapper">

    <!-- 게시글 기본 컬럼 -->
    <sql id="boardColumns">
        board_id, writer_id, title, description, thumbnail_url,
        deal_state, view_cnt as viewCount, created_at, updated_at
    </sql>

    <!-- 게시글 목록 조회 (페이징) -->
    <select id="findAllWithPaging" resultType="com.ssafy.board.model.EstimateBoard">
        SELECT
        <include refid="boardColumns" />
        FROM
        board
        ORDER BY
        created_at DESC
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 게시글 ID로 상세 조회 -->
    <select id="findById" resultType="com.ssafy.board.model.EstimateBoard">
        SELECT
        <include refid="boardColumns" />
        FROM
        board
        WHERE
        board_id = #{boardId}
    </select>

    <!-- 게시글 등록 -->
    <insert id="insert" parameterType="com.ssafy.board.model.EstimateBoard" useGeneratedKeys="true" keyProperty="boardId">
        INSERT INTO board (
        writer_id, title, description, thumbnail_url,
        deal_state, view_cnt, created_at, updated_at
        ) VALUES (
        #{writerId}, #{title}, #{description}, #{thumbnailUrl},
        #{dealState}, 0, NOW(), NOW()
        )
    </insert>

    <!-- 게시글 수정 -->
    <update id="update" parameterType="com.ssafy.board.model.EstimateBoard">
        UPDATE board
        SET
        title = #{title},
        description = #{description},
        thumbnail_url = #{thumbnailUrl},
        deal_state = #{dealState},
        updated_at = NOW()
        WHERE
        board_id = #{boardId}
    </update>

    <!-- 게시글 삭제 -->
    <delete id="deleteById">
        DELETE FROM board
        WHERE board_id = #{boardId}
    </delete>

    <!-- 조회수 증가 -->
    <update id="incrementViewCount">
        UPDATE board
        SET view_cnt = view_cnt + 1
        WHERE board_id = #{boardId}
    </update>

    <!-- 게시글 총 개수 조회 -->
    <select id="countAll" resultType="int">
        SELECT COUNT(*) FROM board
    </select>

    <!-- 특정 사용자가 작성한 게시글 목록 조회 -->
    <select id="findByWriterId" resultType="com.ssafy.board.model.EstimateBoard">
        SELECT
        <include refid="boardColumns" />
        FROM
        board
        WHERE
        writer_id = #{writerId}
        ORDER BY
        created_at DESC
        LIMIT #{offset}, #{limit}
    </select>
</mapper>